<!DOCTYPE html>
<html lang="ar">
<head>

<script>
/*
  ğŸ” Ø­Ù…Ø§ÙŠØ© admin.html
  - Ù„Ø§ Ù†Ø­Ø°Ù Ø£ÙŠ ÙƒÙˆØ¯
  - Ù†Ù†ØªØ¸Ø± Firebase
  - Ù†ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
*/
document.addEventListener("DOMContentLoaded", async function () {

  let waitCount = 0;

  const waitForFirebase = setInterval(() => {
    waitCount++;

    if (window.firestoreTools && window.firestoreTools.db) {
      clearInterval(waitForFirebase);

      const ADMIN_EMAIL = "admin@gmail.com";
      const email = localStorage.getItem("loggedEmail");

      if (!email || email !== ADMIN_EMAIL) {
        location.href = "index.html";
      }
    }

    // Ù„Ùˆ Firebase Ù„Ù… ÙŠØ¬Ù‡Ø² Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
    if (waitCount > 30) {
      clearInterval(waitForFirebase);
      location.href = "index.html";
    }

  }, 100);
});
</script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel</title>
</head>

<body style="font-family: Arial; direction: rtl; text-align: center; margin-top: 50px;">

  <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† âœ…</h1>
  <p>ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.</p>

  <button onclick="logoutAdmin()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

  <!-- ====== Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ù…ØªØ­Ø±Ùƒ ====== -->
  <hr style="margin:40px 0">

  <h2>ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù† Ù…ØªØ­Ø±Ùƒ Ù„Ù„Ø·Ù„Ø§Ø¨</h2>

  <textarea id="announcement"
    placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù‡Ù†Ø§..."
    style="width:80%; height:80px; font-size:16px;"></textarea>

  <br><br>

  <button onclick="saveAnnouncement()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
  <button onclick="clearAnnouncement()">âŒ Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>

<script>
  function logoutAdmin() {
    // â›” Ù„Ø§ Ù†Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…
    localStorage.removeItem("isAdmin");

    // âœ… Ù†Ø¶ÙŠÙ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ (Ø§Ù„Ø¬Ø¯ÙŠØ¯)
    localStorage.removeItem("loggedEmail");

    window.location.href = "./index.html";
  }
</script>

<script>
async function saveAnnouncement() {
  const text = document.getElementById("announcement").value.trim();

  if (!text) {
    alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø£ÙˆÙ„Ù‹Ø§");
    return;
  }

  if (!window.firestoreTools || !window.firestoreTools.db) {
    alert("Firebase ØºÙŠØ± Ø¬Ø§Ù‡Ø²");
    return;
  }

  const db = window.firestoreTools.db;

  await db.collection("settings").doc("announcement").set({
    text: text,
    active: true,
    updatedAt: new Date().toISOString()
  });

  alert("âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨");
}

async function clearAnnouncement() {
  if (!window.firestoreTools || !window.firestoreTools.db) {
    alert("Firebase ØºÙŠØ± Ø¬Ø§Ù‡Ø²");
    return;
  }

  const db = window.firestoreTools.db;

  await db.collection("settings").doc("announcement").set({
    text: "",
    active: false
  });

  document.getElementById("announcement").value = "";
  alert("ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†");
}
</script>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="./js/firebase.js"></script>

</body>
</html>
