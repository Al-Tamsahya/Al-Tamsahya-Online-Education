<!DOCTYPE html>
<html lang="ar" dir="rtl">
<!-- ğŸš¨ Ø´Ø±ÙŠØ· Ø¥Ø¹Ù„Ø§Ù† Ù…ØªØ­Ø±Ùƒ Ù„Ù„Ø·Ù„Ø§Ø¨ -->
<div id="announcementBar" class="announcement-bar" style="display:none;">
    <div class="announcement-text" id="announcementText"></div>
</div>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„ØªÙ…Ø³Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            direction: rtl;
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-bar {
            background-color: #ff9900;
            color: white;
            text-align: center;
            padding: 5px 0;
            font-size: 14px;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ù†ØµØ© */
        .header {
            background-color: #009688;
            color: white;
            padding: 15px;
            text-align: right;
            position: relative;
        }

        .dark-mode-btn {
            position: absolute;
            left: 10px;
            top: 10px;
            padding: 4px 6px;
            cursor: pointer;
        }

        /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© */
        .content {
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 5px;
        }

        p.description {
            text-align: center;
            color: #555;
        }

        /* ØµÙ†Ø¯ÙˆÙ‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-box {
            max-width: 300px;
            margin: 30px auto;
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
        }

            .login-box h2 {
                text-align: center;
                margin-bottom: 20px;
            }

            .login-box input {
                width: 100%;
                padding: 10px;
                margin: 10px 0;
                border-radius: 5px;
                border: 1px solid #ccc;
                box-sizing: border-box;
            }

            .login-box button {
                width: 100%;
                padding: 10px;
                margin: 10px 0;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            }

        .login-btn {
            background-color: #3366ff;
            color: white;
            font-weight: bold;
        }

        .register-btn {
            background-color: #00bcd4;
            color: #333;
        }

        /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ */
        body.dark-mode {
            background-color: #1e293b;
            color: #ddd;
        }

            body.dark-mode .login-box {
                background-color: #777;
                color: #fff;
            }

            body.dark-mode input {
                background-color: #ccc;
                color: #fff;
                border: 1px solid #777;
            }

            body.dark-mode .login-btn {
                background-color: #16a34a;
            }
    </style>
</head>
<body>


    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ù†ØµØ© -->
    <div class="header">
        Ù…Ù†ØµØ© Ø§Ù„ØªÙ…Ø³Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©
        <button class="dark-mode-btn" onclick="toggleDarkMode()" id="darkModeBtn">
            ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
        </button>
    </div>
    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© -->
    <div class="content">
        <p class="description">
            <!-- ğŸ§‘â€ğŸ“ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø±Ø³Ù…ÙŠØ© -->
            <section class="welcome-message" id="welcomeMessage">

                <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒÙ… ÙÙŠ Ù…Ù†ØµØ© Ø§Ù„ØªÙ…Ø³Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ğŸ“</h2>

                <p>
                    Ù†Ø±Ø­Ø¨ Ø¨Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ© ÙÙŠ Ù…Ù†ØµØªÙ†Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©ØŒ
                    ÙˆØ§Ù„ØªÙŠ ØªÙ‡Ø¯Ù Ø¥Ù„Ù‰ ØªÙ‚Ø¯ÙŠÙ… Ù…Ø­ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ…ÙŠ Ù…Ø¨Ø³Ø· ÙˆÙ…Ù†Ø¸Ù…
                    ÙˆÙÙ‚Ù‹Ø§ Ù„Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ù…ØµØ±ÙŠ.
                </p>
                <p>
                    ØªØªÙŠØ­ Ø§Ù„Ù…Ù†ØµØ© Ø¯Ø±ÙˆØ³Ù‹Ø§ ØªÙØ§Ø¹Ù„ÙŠØ©ØŒ Ø´Ø±ÙˆØ­Ø§Øª Ù…Ø±Ø¦ÙŠØ©ØŒ
                    ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ù…Ø³ØªÙ…Ø±Ø© Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ.
                </p>
                <p>
                    <strong>Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… ØªØ¬Ø±Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù†Ø§Ø¬Ø­Ø© ÙˆÙ…Ø«Ù…Ø±Ø© ğŸŒŸ</strong>
                </p>
            </section>

            <!-- ØµÙ†Ø¯ÙˆÙ‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <form class="login-box" id="loginPage">
                <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>

                <input type="email" name="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>

                <input type="password" name="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>

                <button type="submit" class="login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>

                <p style="margin-top:15px;">
                    <a href="#" onclick="registerStudentPage()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
                </p>
            </form>

            <script>
                function toggleDarkMode() {
                    document.body.classList.toggle('dark-mode');
                }
            </script>
            <meta name="application-name" content="Ù…Ù†ØµØ© Ø§Ù„ØªÙ…Ø³Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©">
            <meta name="description" content="Ù…Ù†ØµØ© Ø§Ù„ØªÙ…Ø³Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØªÙ‚Ø¯Ù… Ù…Ø­ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ…ÙŠ Ø¹Ø±Ø¨ÙŠ Ù…Ø¨Ø³Ø· Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ©">

            <!-- Open Graph (Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§) -->
            <meta property="og:title" content="Ù…Ù†ØµØ© Ø§Ù„ØªÙ…Ø³Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©">
            <meta property="og:description" content="Ù…Ù†ØµØ© Ø¹Ø±Ø¨ÙŠØ© Ù…ØªØ®ØµØµØ© ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ©">
            <meta property="og:type" content="website">
            <meta property="og:url" content="https://elkhatib-ai.github.io/Al-Tamsahya-Online-Education/">
            <meta property="og:image" content="https://elkhatib-ai.github.io/Al-Tamsahya-Online-Education/icon-192.png">


            <link rel="stylesheet" href="css/style.css">

            <!-- Ø§Ù„Ø®Ø·ÙˆØ· -->
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
            <!-- PWA -->
            <link rel="manifest" href="manifest.json">
            <meta name="theme-color" content="#1e40af">

            <!-- Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
            <link rel="icon" href="icon-192.png">
            <link rel="apple-touch-icon" href="icon-192.png">
            <link rel="icon" type="image/x-icon" href="/Al-Tamsahya-Online-Education/favicon.ico">

            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-E4BFPGRT2R"></script>
            <script>
                window.dataLayer = window.dataLayer || [];
                function gtag() { dataLayer.push(arguments); }
                gtag('js', new Date());

                gtag('config', 'G-E4BFPGRT2R');
            </script>

            <div id="studentAnnouncement"
                 style="display:none; background:#fff3cd; padding:15px; margin:15px; border-radius:8px;">
            </div>


            <!-- ğŸ”” Ø¥Ø¹Ù„Ø§Ù† Ù…ØªØ­Ø±Ùƒ -->
            <div id="promoAd" class="promo-ad hidden">
                <div class="promo-content">
                    <div id="promoText"></div>
                    <br>
                    <button onclick="closeAd()">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
            </div>

            <div id="ads-container">
                <!-- Ù‡Ù†Ø§ Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ -->
            </div>
            <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¯Ù…Ù† -->
            <div id="admin-panel" style="display:none;">
                <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h2>
                <input type="text" id="ad-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
                <textarea id="ad-content" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†"></textarea>
                <button id="add-ad-btn">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</button>
            </div>


            <!-- ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† -->
            <div id="adminPage" style="display:none; padding:20px; text-align:center;">
                <h1>âœ… Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</h1>
                <p>ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.</p>

                <button onclick="logoutAdmin()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>



            <!-- ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ø·Ø§Ù„Ø¨ -->
            <div id="registerPage" class="login-container hidden">

                <h1 class="register-title">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h1>

                <input type="text" id="regEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                <input type="password" id="regPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

                <button class="register-btn primary"
                        onclick="registerStudent()">
                    Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                </button>

                <button class="register-btn secondary"
                        onclick="backToLogin()">
                    Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>

                <p class="trust-message">
                    ğŸ”’ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø£Ù…Ø§Ù†<br>
                    ÙˆÙ„Ø§ ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ Ù…Ø¹ Ø£ÙŠ Ø¬Ù‡Ø© Ø®Ø§Ø±Ø¬ÙŠØ©
                </p>

            </div>



            <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <div id="mainPage" class="hidden">

                <!-- ØµÙØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ -->
                <div id="gradePage" class="list-container"></div>

                <!-- ØµÙØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø¯Ø© -->
                <div id="subjectPage" class="list-container hidden"></div>

                <!-- ØµÙØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ­Ø¯Ø© -->
                <div id="unitPage" class="list-container hidden"></div>

                <div id="lessonPath" class="lesson-path"></div>
                <!-- ØµÙØ­Ø© Ø§Ù„Ø¯Ø±Ø³ -->
                <div id="lessonPage" class="hidden">

                    <div class="nav-btns"></div>

                    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
                    <div class="progress-box">
                        <div id="progressBar" class="progress-bar"></div>
                    </div>

                    <h2 id="lessonTitle"></h2>

                    <button id="toggleLessonsBtn" class="toggle-lessons-btn" onclick="toggleLessons()">
                        ğŸ“š Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³
                    </button>

                    <div id="lessonList" class="list-container"></div>

                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø¯Ø±ÙˆØ³ -->
                    <div class="nav-btns">
                        <button id="prevLessonBtn" onclick="prevLesson()">â¬…ï¸ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                        <button id="nextLessonBtn" onclick="nextLesson()">â¡ï¸ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ§Ù„ÙŠ</button>
                    </div>

                    <div id="lessonPageContent">
                        <div id="lessonVideo"></div>
                        <div id="lessonText"></div>
                    </div>

                </div>



                <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø¯ÙŠØ± ÙˆØ§Ù„Ù…Ø´Ø±Ù -->

                <div id="adminPanel" class="admin-box hidden">
                    <h3>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>

                    <div class="nav-btns">
                        <button class="custom-btn" onclick="showAdminSection('students')">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</button>
                        <button class="custom-btn" onclick="showAdminSection('supervisors')">Ø§Ù„Ù…Ø´Ø±ÙÙˆÙ†</button>
                        <button class="custom-btn" onclick="showAdminSection('tests')">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
                        <button class="custom-btn" onclick="showAdminSection('results')">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</button>
                    </div>

                    <!-- ğŸ”” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ ADMIN) -->
                    <div id="adminAdBox"
                         style="display:none; border:2px dashed #f39c12; padding:15px; margin:20px; border-radius:8px;">

                        <h4>ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù† Ø¹Ø§Ù… Ù„Ù„Ø·Ù„Ø§Ø¨</h4>

                        <textarea id="adminAdText"
                                  placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù‡Ù†Ø§..."
                                  style="width:100%; min-height:80px; padding:8px;">
        </textarea>

                        <div style="margin-top:10px;">
                            <button class="custom-btn" onclick="saveAnnouncement()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
                            <button class="custom-btn danger" onclick="deleteAnnouncement()">ğŸ—‘ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
                        </div>
                    </div>

                    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
                    <div id="adminContent">
                        <div id="studentsList" class="table-container hidden"></div>
                        <div id="supervisorsList" class="table-container hidden"></div>
                        <div id="testsList" class="table-container hidden"></div>
                        <div id="resultsList" class="table-container hidden"></div>
                    </div>
                </div>



                <!-- Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
                <div id="studentModal" class="modal">
                    <div class="modal-content">
                        <h3>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
                        <input type="text" id="newStudentEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
                        <input type="password" id="newStudentPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
                        <br />
                        <button onclick="addStudent()">Ø¥Ø¶Ø§ÙØ©</button>
                        <button class="close-btn" onclick="closeModal('studentModal')">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>

                <div id="supervisorModal" class="modal">
                    <div class="modal-content">
                        <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯</h3>
                        <input type="text" id="newSupervisorEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
                        <input type="password" id="newSupervisorPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
                        <br />
                        <button onclick="addSupervisor()">Ø¥Ø¶Ø§ÙØ©</button>
                        <button class="close-btn" onclick="closeModal('supervisorModal')">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>

                <button class="logout-btn hidden" onclick="logout()">
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                </button>

                <footer>Â© 2026 Ù…Ù†ØµØ© Ø§Ù„ØªÙ…Ø³Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</footer>

                <script>
                    // âœ… Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… defaultUsers Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§
                    // Ù„Ø£Ù† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø£ØµØ¨Ø­Øª Ù…Ù† Firestore ÙˆÙ„ÙŠØ³ Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯

                    // let users = JSON.parse(localStorage.getItem("users") || "[]");


                    const grades = ["Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ"];
                    const subjectsPerGrade = {
                        "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ": [
                            "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                            "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",
                            "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª",
                            "Ø§Ù„Ø¹Ù„ÙˆÙ…",
                            "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",
                            "Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©",
                            "Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙÙ†ÙŠ/Ø§Ù„Ø­Ø§Ø³Ø¨ Ø§Ù„Ø¢Ù„ÙŠ/Ø§Ù„Ø±ÙŠØ§Ø¶Ø©",
                        ],
                        "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ": [
                            "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                            "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",
                            "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª",
                            "Ø§Ù„Ø¹Ù„ÙˆÙ…",
                            "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",
                            "Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©",
                            "Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙÙ†ÙŠ/Ø§Ù„Ø­Ø§Ø³Ø¨ Ø§Ù„Ø¢Ù„ÙŠ/Ø§Ù„Ø±ÙŠØ§Ø¶Ø©",
                        ],
                        "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ": [
                            "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                            "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",
                            "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª",
                            "Ø§Ù„Ø¹Ù„ÙˆÙ…",
                            "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",
                            "Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©",
                            "Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙÙ†ÙŠ/Ø§Ù„Ø­Ø§Ø³Ø¨ Ø§Ù„Ø¢Ù„ÙŠ/Ø§Ù„Ø±ÙŠØ§Ø¶Ø©",
                        ],
                    };
                    const sectionsPerSubject = {
                        "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©": ["Ø§Ù„Ù†Ø­Ùˆ", "Ø§Ù„Ø¨Ù„Ø§ØºØ©", "Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©", "Ø§Ù„Ù†ØµÙˆØµ", "Ø§Ù„ØªØ¹Ø¨ÙŠØ±", "Ø§Ù„Ù‚ØµØ©"],
                        "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©": ["Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯", "Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª", "Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©", "Ø§Ù„ÙƒØªØ§Ø¨Ø©"],
                        Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª: ["Ø¬Ø¨Ø±", "Ù‡Ù†Ø¯Ø³Ø©", "Ø¥Ø­ØµØ§Ø¡", "Ù…Ø±Ø§Ø¬Ø¹Ø©"],
                        Ø§Ù„Ø¹Ù„ÙˆÙ…: ["Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ø·Ø§Ù‚Ø©", "Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ø§Ù„Ø­ÙŠØ©", "Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„ÙØ¶Ø§Ø¡", "Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ø¹Ù„Ù…ÙŠØ©"],
                        "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©": ["Ø§Ù„ØªØ§Ø±ÙŠØ®", "Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§", "Ø§Ù„ÙˆØ·Ù†ÙŠØ©", "Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©"],
                        "Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©": ["Ø§Ù„Ù‚Ø±Ø¢Ù†/Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ù‚Ø¯Ø³", "Ø§Ù„Ø³Ù„ÙˆÙƒ ÙˆØ§Ù„Ù‚ÙŠÙ…"],
                        "Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙÙ†ÙŠ/Ø§Ù„Ø­Ø§Ø³Ø¨ Ø§Ù„Ø¢Ù„ÙŠ/Ø§Ù„Ø±ÙŠØ§Ø¶Ø©": ["Ø§Ù„ÙÙ†ÙˆÙ†", "Ø§Ù„Ø­Ø§Ø³Ø¨ Ø§Ù„Ø¢Ù„ÙŠ", "Ø§Ù„Ø±ÙŠØ§Ø¶Ø©"],
                    };
                    let lessons = {};

                    grades.forEach((grade) => {
                        lessons[grade] = {};

                        subjectsPerGrade[grade].forEach((sub) => {
                            lessons[grade][sub] = {};

                            if (sectionsPerSubject[sub]) {
                                sectionsPerSubject[sub].forEach((unit) => {
                                    lessons[grade][sub][unit] = [
                                        {
                                            title: "Ø¯Ø±Ø³ 1 " + unit,
                                            content: "Ø´Ø±Ø­ Ù†ØµÙŠ Ù…ÙØµÙ„ Ù„Ø¯Ø±Ø³ 1 ÙÙŠ " + unit,
                                            video: `videos/${sub}/${unit}-lesson1.mp4`,
                                        },
                                        {
                                            title: "Ø¯Ø±Ø³ 2 " + unit,
                                            content: "Ø´Ø±Ø­ Ù†ØµÙŠ Ù…ÙØµÙ„ Ù„Ø¯Ø±Ø³ 2 ÙÙŠ " + unit,
                                            video: `videos/${sub}/${unit}-lesson2.mp4`,
                                        },
                                    ];
                                });
                            }
                        });
                    });

                    let scores = JSON.parse(localStorage.getItem("scores") || "{}");

                    let currentUser = null;
                    let currentGrade = null;
                    let currentSubject = null;
                    let currentUnit = null;
                    // ===== ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ =====
                    let currentFilter = "all";
                    let savedStudents = [];

                    // Ø²Ø± Ø§Ù„ÙÙ„ØªØ±Ø©
                    function filterStudentsByStatus(type) {
                        currentFilter = type;
                        renderStudentsFiltered();
                    }

                    // Ø±Ø³Ù… Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„ÙÙ„ØªØ±
                    function renderStudentsFiltered() {
                        let filteredStudents = savedStudents;

                        if (currentFilter === "approved") {
                            filteredStudents = savedStudents.filter(s => s.approved === true);
                        }

                        if (currentFilter === "pending") {
                            filteredStudents = savedStudents.filter(s => s.approved !== true);
                        }

                        drawStudentsTable(filteredStudents);
                    }

                    // Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
                    function drawStudentsTable(students) {
                        let rows = "";

                        students.forEach((s) => {
                            let actions = "";

                            // ğŸ‘‘ ADMIN
                            if (currentUser?.role === "ADMIN") {
                                actions += `
                        <button class="custom-btn"
                          onclick="editStudent('${s.email}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                      `;

                                if (!s.approved) {
                                    actions += `
                          <button class="custom-btn"
                            onclick="setApprove('${s.id}', true)">âœ… Ù…ÙˆØ§ÙÙ‚Ø©</button>

                          <button class="custom-btn danger"
                            onclick="rejectStudent('${s.id}')">âŒ Ø±ÙØ¶</button>
                        `;
                                }
                            }

                            // ğŸ‘¤ SUPERVISOR (Ù…ÙˆØ§ÙÙ‚Ø© ÙÙ‚Ø·)
                            if (currentUser?.role === "SUPERVISOR" && !s.approved) {
                                actions += `
                        <button class="custom-btn"
                          onclick="setApprove('${s.id}', true)">âœ… Ù…ÙˆØ§ÙÙ‚Ø©</button>
                      `;
                            }

                            rows += `
                      <tr data-email="${(s.email || "").toLowerCase()}">
                        <td>${s.email || "-"}</td>
                        <td>
                          ${s.approved
                                    ? `<span class="status approved">ğŸŸ¢ Ù…ÙØ¹Ù„</span>`
                                    : `<span class="status pending">ğŸŸ¡ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>`
                                }
                        </td>
                        <td>${s.grade ?? "-"}</td>
                        <td style="display:flex; gap:6px; justify-content:center;">
                          ${actions || "-"}
                        </td>
                      </tr>
                    `;
                        });

                        document.getElementById("studentsTableBody").innerHTML =
                            rows || `<tr><td colspan="4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨</td></tr>`;
                    }


                    // ===== Ø¨Ø§Ù‚ÙŠ ÙƒÙˆØ¯Ùƒ =====
                    function updateBackButton() {
                        const backBtn = document.getElementById("backBtn");
                        const homeBtn = document.getElementById("homeBtn");
                        const globalNav = document.getElementById("globalNav");

                        if (!backBtn || !homeBtn || !globalNav) return;

                        // Ù„Ùˆ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙÙˆÙ)
                        if (!currentGrade) {
                            globalNav.classList.add("hidden");   // âŒ Ø§Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· ÙƒÙ„Ù‡
                            return;
                        }

                        // ÙÙŠ Ø£ÙŠ ØµÙØ­Ø© Ø¯Ø§Ø®Ù„ÙŠØ©
                        globalNav.classList.remove("hidden");
                        backBtn.style.display = "inline-block";
                        homeBtn.style.display = "inline-block";
                    }




                    // Ø®Ø§Øµ Ø¨Ø§Ù„Ø¯Ø±ÙˆØ³
                    let currentLessonIndex = 0;
                    let currentLessonsList = [];
                    let lessonCompleted = false;

                    // Ø­ÙØ¸ Ø¢Ø®Ø± Ø¯Ø±Ø³ Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ù„Ø·Ø§Ù„Ø¨
                    function saveLastLesson(index) {
                        if (!currentUser || !currentGrade || !currentSubject || !currentUnit) return;

                        const key = `lastLesson_${currentUser.email}_${currentGrade}_${currentSubject}_${currentUnit}`;
                        localStorage.setItem(key, index);
                    }

                    // Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø¯Ø±Ø³ Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ù„Ø·Ø§Ù„Ø¨
                    function getLastLesson() {
                        if (!currentUser || !currentGrade || !currentSubject || !currentUnit) return null;

                        const key = `lastLesson_${currentUser.email}_${currentGrade}_${currentSubject}_${currentUnit}`;
                        const index = localStorage.getItem(key);

                        return index !== null ? parseInt(index) : null;
                    }



                    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    // function saveData() {
                    //     localStorage.setItem("users", JSON.stringify(users));
                    //     localStorage.setItem("scores", JSON.stringify(scores));
                    // }
                    // ===============================
                    // âœ… Firebase DB Global Reference
                    // ===============================
                    function getDB() {
                        if (!window.firestoreTools || !window.firestoreTools.db) {
                            throw new Error("Firebase Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯");
                        }
                        return window.firestoreTools.db;
                    }

                    // ===============================
                    // ===============================
                    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Admin + Supervisor + Student)
                    // ===============================
                    async function login() {
                        const email = document.getElementById("email").value.trim().toLowerCase();
                        const password = document.getElementById("password").value.trim();

                        if (!email || !password) {
                            alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
                            return;
                        }

                        if (!window.firestoreTools || !window.firestoreTools.db) {
                            alert("Firebase Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯");
                            console.log("firestoreTools:", window.firestoreTools);
                            return;
                        }

                        const db = window.firestoreTools.db;

                        try {
                            console.log("=== LOGIN START ===", email);

                            // =========================
                            // 1) Admin login (admins/admin)
                            // =========================
                            const adminRef = db.doc("admins/admin");
                            const adminSnap = await adminRef.get();

                            if (adminSnap.exists) {
                                const adminData = adminSnap.data();
                                const dbEmail = (adminData.email || "").toLowerCase();
                                const dbPass = adminData.password || "";

                                if (dbEmail === email && dbPass === password) {
                                    alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù† âœ…");

                                    localStorage.setItem("isAdmin", "true"); // âœ… Ø­ÙØ¸ Ø§Ù„Ø£Ø¯Ù…Ù†
                                    currentUser = { email: dbEmail, role: "ADMIN" };

                                    document.getElementById("loginPage").classList.add("hidden");
                                    document.getElementById("mainPage").classList.remove("hidden");
                                    document.querySelector(".logout-btn").classList.remove("hidden");

                                    document.getElementById("welcomeMessage").classList.add("hidden");
                                    document.getElementById("navUser").textContent = " | " + dbEmail;

                                    // âœ… Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ø£Ø¯Ù…Ù†
                                    document.getElementById("adminPanel").classList.remove("hidden");
                                    // ğŸ”” Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø±Ø¨Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† + ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ
                                    const adBox = document.getElementById("adminAdBox");
                                    if (adBox) adBox.style.display = "block";

                                    db.collection("announcements").doc("current").get()
                                        .then(doc => {
                                            if (doc.exists && document.getElementById("adminAdText")) {
                                                document.getElementById("adminAdText").value = doc.data().text || "";
                                            }
                                        });


                                    renderGrades();
                                    return;
                                }
                            }

                            // âœ… Ù…Ù‡Ù… Ø¬Ø¯Ù‹Ø§: Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ø£Ø¯Ù…Ù† Ø§Ø­Ø°Ù Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø­ØªÙ‰ Ù„Ø§ ÙŠØ¹Ù„Ù‚ ÙÙŠ admin.html
                            localStorage.removeItem("isAdmin");

                            // =========================
                            // 2) Supervisor login (users)
                            // =========================
                            const supSnap = await db
                                .collection("users")
                                .where("email", "==", email)
                                .where("role", "==", "SUPERVISOR")
                                .get();

                            if (!supSnap.empty) {
                                const supDoc = supSnap.docs[0];
                                const sup = supDoc.data();

                                if (sup.password !== password) {
                                    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø© âŒ");
                                    return;
                                }

                                localStorage.removeItem("isAdmin");

                                currentUser = { ...sup, id: supDoc.id, role: "SUPERVISOR" };

                                document.getElementById("loginPage").classList.add("hidden");
                                document.getElementById("mainPage").classList.remove("hidden");
                                document.querySelector(".logout-btn").classList.remove("hidden");

                                document.getElementById("welcomeMessage").classList.add("hidden");
                                document.getElementById("navUser").textContent = " | " + sup.email;

                                // Ø§Ù„Ù…Ø´Ø±Ù ÙŠØ´ÙˆÙ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                                document.getElementById("adminPanel").classList.remove("hidden");

                                renderGrades();
                                return;
                            }

                            // =========================
                            // 3) Student login (students)
                            // =========================
                            const studentSnap = await db
                                .collection("students")
                                .where("email", "==", email)
                                .get();

                            if (studentSnap.empty) {
                                alert("Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ âŒ");
                                return;
                            }

                            const studentDoc = studentSnap.docs[0];
                            const student = studentDoc.data();

                            if (student.password !== password) {
                                alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø© âŒ");
                                return;
                            }

                            if (student.approved !== true) {
                                alert(
                                    "â³ Ø­Ø³Ø§Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©\n" +
                                    "Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.\n" +
                                    "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§."
                                );
                                return;
                            }


                            // âœ… Student Ù„ÙŠØ³ Admin
                            localStorage.removeItem("isAdmin");

                            currentUser = { ...student, id: studentDoc.id, role: "STUDENT" };

                            document.getElementById("loginPage").classList.add("hidden");
                            document.getElementById("mainPage").classList.remove("hidden");
                            document.querySelector(".logout-btn").classList.remove("hidden");

                            document.getElementById("welcomeMessage").classList.add("hidden");
                            document.getElementById("navUser").textContent = " | " + student.email;

                            // âŒ Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ø·Ù„Ø§Ø¨
                            document.getElementById("adminPanel").classList.add("hidden");

                            renderGrades();
                            return;

                        } catch (err) {
                            console.error(err);
                            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âŒ\n" + err.message);
                        }
                    }

                    function filterStudents() {
                        const input = document.getElementById("studentSearch");
                        const filter = input.value.toLowerCase();
                        const rows = document.querySelectorAll("#studentsList tbody tr");

                        rows.forEach(row => {
                            const email = row.getAttribute("data-email") || "";
                            row.style.display = email.includes(filter) ? "" : "none";
                        });
                    }






                    // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                    function logout() {
                        currentUser = null;

                        // âœ… Ø­Ø°Ù ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø£Ø¯Ù…Ù†
                        localStorage.removeItem("isAdmin");

                        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§
                        document.getElementById("lessonVideo").innerHTML = "";

                        document.getElementById("loginPage").classList.remove("hidden");
                        document.getElementById("registerPage").classList.add("hidden");
                        document.getElementById("mainPage").classList.add("hidden");
                        document.getElementById("adminPanel").classList.add("hidden");
                        document.querySelector(".logout-btn").classList.add("hidden");
                        document.getElementById("navUser").textContent = "";
                        document.getElementById("welcomeMessage").classList.remove("hidden");

                        resetNavigation();
                    }

                    function goHome() {
                        stopVideo();      // â›” Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø«Ù„ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
                        currentGrade = null;
                        currentSubject = null;
                        currentUnit = null;
                        renderGrades();   // Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø­Ù„Ø©
                    }


                    // ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                    function registerStudentPage() {
                        console.log("registerStudentPage clicked"); // Ù„Ù„ØªØ£ÙƒØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„

                        const loginPage = document.getElementById("loginPage");
                        const welcomeMessage = document.getElementById("welcomeMessage");
                        const registerPage = document.getElementById("registerPage");

                        // ğŸ”¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ (Ù„Ù… Ù†Ø­Ø°ÙÙ‡)
                        loginPage.classList.add("hidden");
                        welcomeMessage.classList.add("hidden");
                        registerPage.classList.remove("hidden");

                        // ğŸ”¹ Ø¯Ø¹Ù… Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ø£ÙŠ Ø´ÙŠØ¡)
                        loginPage.style.display = "none";
                        welcomeMessage.style.display = "none";
                        registerPage.style.display = "block";
                    }

                    function backToLogin() {
                        const loginPage = document.getElementById("loginPage");
                        const welcomeMessage = document.getElementById("welcomeMessage");
                        const registerPage = document.getElementById("registerPage");

                        // ğŸ”¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ
                        registerPage.classList.add("hidden");
                        loginPage.classList.remove("hidden");

                        // ğŸ”¹ Ø¯Ø¹Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
                        registerPage.style.display = "none";
                        welcomeMessage.style.display = "block";
                        loginPage.style.display = "block";
                    }

                    // ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
                    async function registerStudent() {
                        const email = document.getElementById("regEmail").value.trim().toLowerCase();
                        const password = document.getElementById("regPassword").value.trim();

                        if (!email || !password) {
                            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!");
                            return;
                        }

                        // âœ… Ù†ÙØ³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£Ø¯Ù…Ù† (compat)
                        const db = window.firestoreTools.db;

                        try {
                            // âœ… Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
                            const existingSnap = await db
                                .collection("students")
                                .where("email", "==", email)
                                .get();

                            if (!existingSnap.empty) {
                                alert("Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ âŒ");
                                return;
                            }

                            // âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Firestore
                            await db.collection("students").add({
                                name: email.split("@")[0],
                                email: email,
                                password: password,
                                role: "STUDENT",
                                approved: false, // ğŸ‘ˆ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
                                createdAt: new Date().toISOString()
                            });

                            alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…\Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©");

                            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
                            document.getElementById("regEmail").value = "";
                            document.getElementById("regPassword").value = "";

                            // Ø±Ø¬ÙˆØ¹ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                            backToLogin();

                        } catch (err) {
                            console.error(err);
                            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ âŒ\n" + err.message);
                        }
                    }





                    // Ø¹Ø±Ø¶ Ø§Ù„ØµÙÙˆÙ Ø¨Ø´ÙƒÙ„ Ø¬Ù…ÙŠÙ„
                    function renderGrades() {
                        resetNavigation();
                        updateGlobalNav(false); // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù‡Ù†Ø§ ÙÙ‚Ø·

                        const container = document.getElementById("gradePage");

                        // Ù‡ÙŠÙƒÙ„ Ù…Ù†Ø³Ù‚
                        container.innerHTML = `
                                                                                                                                        <section class="grades-section">
                                                                                                                                            <h2>Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</h2>
                                                                                                                                            <div class="grades-grid"></div>
                                                                                                                                        </section>
                                                                                                                                    `;

                        const grid = container.querySelector(".grades-grid");

                        grades.forEach((grade) => {
                            const btn = document.createElement("button");
                            btn.textContent = grade;
                            btn.className = "grade-card";
                            btn.onclick = () => {
                                currentGrade = grade;
                                renderSubjects(grade);
                            };
                            grid.appendChild(btn);
                        });

                        showSection("gradePage");
                        updateBackButton();
                    }





                    // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¨Ø´ÙƒÙ„ Ø¬Ù…ÙŠÙ„
                    function renderSubjects(grade) {
                        updateGlobalNav(true);
                        resetNavigation();

                        currentSubject = null;
                        currentUnit = null;

                        const container = document.getElementById("subjectPage");

                        container.innerHTML = `
                                                                                                                                        <section class="subjects-section">
                                                                                                                                            <h2>${grade}</h2>
                                                                                                                                            <p class="section-subtitle">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
                                                                                                                                            <div class="subjects-grid"></div>
                                                                                                                                        </section>
                                                                                                                                    `;

                        const grid = container.querySelector(".subjects-grid");

                        subjectsPerGrade[grade].forEach((sub) => {
                            const btn = document.createElement("button");
                            const icons = {
                                "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©": "ğŸ“˜",
                                "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©": "ğŸ“•",
                                "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª": "ğŸ“",
                                "Ø§Ù„Ø¹Ù„ÙˆÙ…": "ğŸ§ª",
                                "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©": "ğŸŒ",
                                "Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©": "ğŸ•Œ",
                                "Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙÙ†ÙŠ/Ø§Ù„Ø­Ø§Ø³Ø¨ Ø§Ù„Ø¢Ù„ÙŠ/Ø§Ù„Ø±ÙŠØ§Ø¶Ø©": "ğŸ¨"
                            };

                            btn.innerHTML = `
                                                                                                                            <div class="subject-icon">${icons[sub] || "ğŸ“˜"}</div>
                                                                                                                            <div>${sub}</div>
`;

                            btn.className = "subject-card";
                            btn.onclick = () => {
                                currentSubject = sub;
                                renderUnits(grade, sub);
                            };
                            grid.appendChild(btn);
                        });

                        showSection("subjectPage");
                        updateBackButton();
                    }


                    // Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ­Ø¯Ø§Øª
                    // Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…Ù†Ø³Ù‚
                    function renderUnits(grade, subject) {
                        stopVideo();
                        resetNavigation();
                        updateGlobalNav(true);

                        currentUnit = null;

                        const container = document.getElementById("unitPage");

                        container.innerHTML = `
                                                                                                                                        <section class="units-section">
                                                                                                                                            <h2>${subject}</h2>
                                                                                                                                            <p class="section-subtitle">Ø§Ø®ØªØ± Ø§Ù„ÙˆØ­Ø¯Ø©</p>
                                                                                                                                            <div class="units-grid"></div>
                                                                                                                                        </section>
                                                                                                                                    `;

                        const grid = container.querySelector(".units-grid");

                        sectionsPerSubject[currentSubject].forEach((unit) => {

                            const btn = document.createElement("button");
                            btn.textContent = unit;
                            btn.className = "unit-card";
                            btn.onclick = () => {
                                currentUnit = unit;
                                renderLessons(grade, subject, unit);
                            };
                            grid.appendChild(btn);
                        });

                        showSection("unitPage");
                        updateBackButton();
                    }



                    // Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø±ÙˆØ³
                    function renderLessons(grade, subject, unit) {
                        resetNavigation();

                        currentLessonsList = lessons[grade][subject][unit];

                        // ğŸ”¹ Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø¯Ø±Ø³ Ù…Ø­ÙÙˆØ¸
                        const lastIndex = getLastLesson();
                        currentLessonIndex =
                            lastIndex !== null && lastIndex < currentLessonsList.length
                                ? lastIndex
                                : 0;
                        document.getElementById("lessonPath").style.display = "block";

                        showSection("lessonPage");
                        updateBackButton();

                        document.getElementById("lessonTitle").textContent =
                            `${grade} - ${subject} - ${unit}`;

                        renderLessonList();
                        loadLesson(currentLessonIndex);
                    }

                    function showLessonDetail(lesson) {
                        const videoDiv = document.getElementById("lessonVideo");
                        const textDiv = document.getElementById("lessonText");

                        videoDiv.innerHTML = `
                        <video
                          id="lessonPlayer"
                          controls
                          playsinline
                          preload="auto"
                          muted
                          width="100%"
                          style="max-height: 220px; border-radius: 12px;"
                        >
                          <source src="./videos/Lesson1.mp4?v=1" type="video/mp4">
                          Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                        </video>
                      `;

                        const video = document.getElementById("lessonPlayer");
                        if (video) {
                            video.play().catch(err => console.log("Autoplay blocked:", err));

                            lessonCompleted = false;
                            const nextBtn = document.getElementById("nextLessonBtn");
                            if (nextBtn) nextBtn.disabled = true;

                            video.addEventListener("loadeddata", () => {
                                video.muted = false;
                                video.play().catch(() => console.log("Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø§Ù„ØµÙˆØª"));
                            });

                            video.addEventListener("ended", () => {
                                lessonCompleted = true;
                                if (nextBtn) nextBtn.disabled = false;
                                saveLastLesson(currentLessonIndex);
                            });
                        }

                        textDiv.textContent = lesson.content;
                        updateLessonNav(true);
                    }


                    // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³ Ø¨Ø´ÙƒÙ„ ÙƒØ±ÙˆØª
                    function renderLessonList() {
                        const listDiv = document.getElementById("lessonList");
                        if (!listDiv) return;

                        listDiv.innerHTML = `<div class="lessons-grid"></div>`;
                        const grid = listDiv.querySelector(".lessons-grid");

                        currentLessonsList.forEach((lesson, index) => {
                            const btn = document.createElement("button");
                            btn.textContent = lesson.title;
                            btn.className = "lesson-card";
                            btn.onclick = () => loadLesson(index);
                            grid.appendChild(btn);
                        });
                    }


                    // â–¶ï¸ ØªØ­Ù…ÙŠÙ„ Ø¯Ø±Ø³ Ù…Ø¹ÙŠÙ†
                    function loadLesson(index) {
                        currentLessonIndex = index;
                        lessonCompleted = false;
                        document.getElementById("lessonList").style.display = "none";

                        const lesson = currentLessonsList[index];

                        // Ù…Ø³Ø§Ø± Ø§Ù„Ø¯Ø±Ø³
                        document.getElementById("lessonPath").innerHTML = `
                                                                                                                                <span>${currentSubject}</span>
                                                                                                                                <span> &gt; </span>
                                                                                                                                <span>${currentUnit}</span>
                                                                                                                                <span> &gt; </span>
                                                                                                                                <strong>${lesson.title}</strong>
                                                                                                                            `;

                        showLessonDetail(lesson);

                        const prevBtn = document.getElementById("prevLessonBtn");
                        const nextBtn = document.getElementById("nextLessonBtn");

                        if (prevBtn) prevBtn.disabled = index === 0;
                        if (nextBtn) nextBtn.disabled = true;

                        // ğŸ“Š Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                        const progress =
                            ((index + 1) / currentLessonsList.length) * 100;
                        document.getElementById("progressBar").style.width = progress + "%";

                        saveLastLesson(index);
                    }



                    function prevLesson() {
                        if (currentLessonIndex > 0) {
                            currentLessonIndex--;
                            loadLesson(currentLessonIndex);
                        }
                    }

                    function nextLesson() {
                        // ğŸ”’ Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©: Ù„Ø§ ÙŠÙ†ØªÙ‚Ù„ Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø¯Ø±Ø³
                        if (!lessonCompleted) {
                            alert("ÙŠØ¬Ø¨ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙƒØ§Ù…Ù„Ù‹Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ§Ù„ÙŠ");
                            return;
                        }

                        if (currentLessonIndex < currentLessonsList.length - 1) {
                            currentLessonIndex++;
                            loadLesson(currentLessonIndex);
                        } else {
                            alert("ğŸ‰ Ø£Ø­Ø³Ù†Øª! Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø¯Ø±ÙˆØ³ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ­Ø¯Ø©");
                        }
                    }


                    // Ø§Ù„ØªÙ†Ù‚Ù„ Ù„Ù„Ø±Ø¬ÙˆØ¹ Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø©
                    function back(page) {
                        stopVideo();           // â›” Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙˆØ± Ø§Ù„Ø±Ø¬ÙˆØ¹
                        updateLessonNav(false); // âœ… Ø¥Ø®ÙØ§Ø¡ Ø²Ø± "Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø¯Ø©"
                        document.getElementById("lessonList").style.display = "block";

                        switch (page) {
                            case "grade":
                                renderGrades();
                                break;
                            case "subject":
                                if (currentGrade) renderSubjects(currentGrade);
                                break;
                            case "unit":
                                if (currentGrade && currentSubject) renderUnits(currentGrade, currentSubject);
                                break;
                            default:
                                renderGrades();
                        }
                    }

                    function smartBack() {
                        stopVideo();

                        if (currentUnit) {
                            // Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø±ÙˆØ³ â†’ Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø¯Ø§Øª
                            currentUnit = null;
                            renderUnits(currentGrade, currentSubject);
                        }
                        else if (currentSubject) {
                            // Ø¯Ø§Ø®Ù„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª â†’ Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ÙˆØ§Ø¯
                            currentSubject = null;
                            renderSubjects(currentGrade);
                        }
                        else if (currentGrade) {
                            // Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ§Ø¯ â†’ Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙÙˆÙ
                            currentGrade = null;
                            renderGrades();
                        }
                    }



                    // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ù…Ø¹ÙŠÙ† ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
                    function showSection(idToShow) {
                        ["gradePage", "subjectPage", "unitPage", "lessonPage"].forEach((id) => {
                            document.getElementById(id).classList.toggle("hidden", id !== idToShow);
                        });
                        // Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ØªØ¸Ù‡Ø± Ù…Ø¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø§ ÙˆÙ„Ø§ ØªØ¤Ø«Ø± Ù‡Ù†Ø§
                    }

                    // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                    function hideAllAdminSections() {
                        ["studentsList", "supervisorsList", "testsList", "resultsList"].forEach((id) => {
                            document.getElementById(id).classList.add("hidden");
                        });
                    }

                    // Ø¹Ø±Ø¶ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                    function showAdminSection(section) {
                        hideAllAdminSections();
                        switch (section) {
                            case "students":
                                renderStudents();
                                break;
                            case "supervisors":
                                renderSupervisors();
                                break;
                            case "tests":
                                renderTests();
                                break;
                            case "results":
                                renderResults();
                                break;
                        }
                    }
                    async function loadPendingStudents() {
                        const res = await fetch("/api/students/pending"); // Ù†Ø·Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
                        const data = await res.json();                    // Ù†Ø­ÙˆÙ„Ù‡Ø§ JSON
                        console.log(data);                                // Ù†Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Console
                    }

                    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ (ØªØ¹Ø±Ø¶ ÙÙ‚Ø· Ù„Ù„Ù…Ø¯ÙŠØ± ÙˆØ§Ù„Ù…Ø´Ø±Ù)
                    // ==============================
                    // ğŸ‘¨â€ğŸ’¼ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ø´Ø±ÙÙŠÙ† (Firestore)
                    // ==============================
                    // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨
                    // supervisors.js
                    async function renderSupervisors() {
                        hideAllAdminSections();
                        const container = document.getElementById("supervisorsList");
                        container.classList.remove("hidden");

                        const snapshot = await firebase.firestore().collection("users")
                            .where("role", "==", "SUPERVISOR").get();

                        let rows = snapshot.docs.map(doc => {
                            const s = doc.data();
                            return `<tr><td>${s.email}</td><td>
                      <button onclick="deleteUser('${doc.id}','users')" class="danger">Ø­Ø°Ù</button>
                    </td></tr>`;
                        }).join("");

                        container.innerHTML = `
<h4>Ø§Ù„Ù…Ø´Ø±ÙÙˆÙ†</h4>
<button onclick="showAddSupervisorModal()">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù</button>
<table>
<thead><tr><th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th><th>Ø®ÙŠØ§Ø±Ø§Øª</th></tr></thead>
<tbody>${rows || `<tr><td colspan="2">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø±ÙÙŠÙ†</td></tr>`}</tbody>
</table>`;
                    }

                    async function addSupervisor() {
                        const email = document.getElementById("newSupervisorEmail").value.trim();
                        const password = document.getElementById("newSupervisorPassword").value.trim();
                        if (!email || !password) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!");

                        try {
                            const userCred = await firebase.auth().createUserWithEmailAndPassword(email, password);
                            await firebase.firestore().collection("users").doc(userCred.user.uid).set({
                                email,
                                role: "SUPERVISOR",
                                createdAt: new Date().toISOString()
                            });

                            alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±Ù âœ…");
                            renderSupervisors();
                            closeModal("supervisorModal");
                        } catch (err) {
                            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ âŒ\n" + err.message);
                        }
                    }


                    // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨
                    function showAddStudentModal() {
                        document.getElementById("newStudentEmail").value = "";
                        document.getElementById("newStudentPassword").value = "";
                        document.getElementById("studentModal").style.display = "flex";
                    }

                    // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (Firestore)
                    async function addStudent() {
                        const email = document.getElementById("newStudentEmail").value.trim().toLowerCase();
                        const password = document.getElementById("newStudentPassword").value.trim();

                        if (!email || !password) {
                            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!");
                            return;
                        }

                        try {
                            const { collection, addDoc, getDocs, query, where } = window.firestoreTools;

                            // âœ… Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
                            const db = window.firestoreTools.db;

                            const q = query(collection(db, "students"), where("email", "==", email));

                            const snap = await getDocs(q);

                            if (!snap.empty) {
                                alert("Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„!");
                                return;
                            }

                            await addDoc(collection(db, "students"), {
                                name: email.split("@")[0],
                                email,
                                password,
                                role: "STUDENT",
                                approved: true, // Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠØ¶ÙŠÙÙ‡ Ù…ÙØ¹Ù„
                                createdAt: new Date().toISOString()
                            });

                            alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…");

                            closeModal("studentModal");
                            renderStudents();

                        } catch (err) {
                            console.error(err);
                            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ âŒ");
                        }
                    }


                    // ==============================
                    // ğŸ‘¨â€ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†
                    // ==============================

                    async function renderSupervisors() {
                        const container = document.getElementById("supervisorsList");

                        container.classList.remove("hidden");
                        ["studentsList", "testsList", "resultsList"].forEach((id) =>
                            document.getElementById(id).classList.add("hidden")
                        );

                        container.innerHTML = `
                        <h4>Ø§Ù„Ù…Ø´Ø±ÙÙˆÙ†</h4>
                        <button class="custom-btn" onclick="showAddSupervisorModal()">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù</button>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†...</p>
                      `;

                        try {
                            if (!window.firestoreTools || !window.firestoreTools.db) {
                                container.innerHTML = `<p>Firebase Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯ âŒ</p>`;
                                return;
                            }

                            const db = window.firestoreTools.db;

                            // âœ… compat query
                            const snap = await db
                                .collection("users")
                                .where("role", "==", "SUPERVISOR")
                                .get();

                            let rows = "";

                            snap.forEach((docSnap) => {
                                const s = docSnap.data();
                                const id = docSnap.id;

                                rows += `
                            <tr>
                              <td>${s.email || "-"}</td>
                              <td>
                                <button class="custom-btn" onclick="deleteUser('${id}', 'users')">Ø­Ø°Ù</button>
                              </td>
                            </tr>
                          `;
                            });

                            container.innerHTML = `
                          <h4>Ø§Ù„Ù…Ø´Ø±ÙÙˆÙ†</h4>
                          <button class="custom-btn" onclick="showAddSupervisorModal()">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù</button>
                          <div style="margin:10px 0;">
                  <button onclick="filterStudents('all')">Ø§Ù„ÙƒÙ„</button>
                  <button onclick="filterStudents('approved')">ğŸŸ¢ Ù…ÙØ¹Ù„ÙŠÙ†</button>
                  <button onclick="filterStudents('pending')">ğŸŸ¡ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</button>
</div>

                          <div class="table-container">
                            <table>
                              <thead>
                                <tr>
                                  <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                                  <th>Ø®ÙŠØ§Ø±Ø§Øª</th>
                                </tr>
                              </thead>
                              <tbody>
                                ${rows || `<tr><td colspan="2">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø±ÙÙŠÙ† Ø­Ø§Ù„ÙŠØ§</td></tr>`}
                              </tbody>
                            </table>
                          </div>
                        `;
                        } catch (err) {
                            console.error(err);
                            container.innerHTML = `<p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† âŒ<br>${err.message}</p>`;
                        }
                    }


                    // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù
                    function showAddSupervisorModal() {
                        document.getElementById("newSupervisorEmail").value = "";
                        document.getElementById("newSupervisorPassword").value = "";
                        document.getElementById("supervisorModal").style.display = "flex";
                    }

                    // Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯ (Firestore)
                    async function addSupervisor() {
                        const email = document.getElementById("newSupervisorEmail").value.trim().toLowerCase();
                        const password = document.getElementById("newSupervisorPassword").value.trim();

                        if (!email || !password) {
                            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!");
                            return;
                        }

                      try {
  if (!window.firestoreTools || !window.firestoreTools.db) {
      alert("Firebase Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯ âŒ");
      return;
  }

  // Ø§Ø³ØªØ®Ø¯Ù… window.db Ø¨Ø¯Ù„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø±ÙŠÙ const db
  const snap = await window.db.collection("users").where("email", "==", email).get();

  if (!snap.empty) {
      alert("Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„!");
      return;
  }
                            await db.collection("users").add({
                                name: email.split("@")[0],
                                email,
                                password,
                                role: "SUPERVISOR",
                                createdAt: new Date().toISOString()
                            });

                            alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±Ù Ø¨Ù†Ø¬Ø§Ø­ âœ…");

                            closeModal("supervisorModal");
                            renderSupervisors();

                        } catch (err) {
                            console.error(err);
                            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±Ù âŒ\n" + err.message);
                        }
                    }




                    // ==============================
                    // ğŸ—‘ï¸ Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…/Ø·Ø§Ù„Ø¨ (Firestore)
                    async function deleteUser(docId, collectionName) {
                        if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) return;

                        try {
                            const db = window.firestoreTools.db;

                            await db.collection(collectionName).doc(docId).delete();

                            alert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­ âœ…");

                            if (collectionName === "students") renderStudents();
                            if (collectionName === "users") renderSupervisors();

                        } catch (err) {
                            console.error(err);
                            alert("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù âŒ\n" + err.message);
                        }
                    }
                    // âœ… Ù…ÙˆØ§ÙÙ‚Ø© / Ø±ÙØ¶ Ø·Ø§Ù„Ø¨
                    async function setApprove(studentDocId, approvedValue) {
                        try {
                            const db = window.firestoreTools.db;
                            const ref = db.collection("students").doc(studentDocId);
                            const snap = await ref.get();

                            if (!snap.exists) return;

                            if (snap.data().approved === true) {
                                alert("Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙØ¹Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ âœ…");
                                return;
                            }

                            await ref.update({ approved: approvedValue });

                            alert("ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© âœ…");
                            renderStudents();

                        } catch (err) {
                            console.error(err);
                            alert("ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« âŒ");
                        }
                    }

                    // âŒ Ø±ÙØ¶ Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹)
                    async function rejectStudent(studentDocId) {
                        if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø±ÙØ¶ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ­Ø°Ù Ø·Ù„Ø¨Ù‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) return;

                        try {
                            const db = window.firestoreTools.db;

                            await db.collection("students").doc(studentDocId).delete();

                            alert("ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ­Ø°ÙÙ‡ âŒ");
                            renderStudents();

                        } catch (err) {
                            console.error(err);
                            alert("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¶ âŒ\n" + err.message);
                        }
                    }

                    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
                    function closeModal(id) {
                        document.getElementById(id).style.display = "none";
                    }

                    // Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®Ø±Ù‰ (Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¨Ø¯Ø¦ÙŠ)
                    function renderTests() {
                        const container = document.getElementById("testsList");
                        container.innerHTML = `<h4>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h4><p>Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„Ø§Ø­Ù‚Ø§Ù‹.</p>`;
                        container.classList.remove("hidden");
                        ["studentsList", "supervisorsList", "resultsList"].forEach((id) =>
                            document.getElementById(id).classList.add("hidden")
                        );
                    }
                    function renderResults() {
                        const container = document.getElementById("resultsList");
                        container.innerHTML = `<h4>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h4><p>Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù„Ù„Ø·Ù„Ø§Ø¨.</p>`;
                        container.classList.remove("hidden");
                        ["studentsList", "supervisorsList", "testsList"].forEach((id) =>
                            document.getElementById(id).classList.add("hidden")
                        );
                    }

                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙ†Ù‚Ù„ (Ø§Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª Ø¹Ø¯Ø§ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
                    function resetNavigation() {
                        document.getElementById("gradePage").classList.add("hidden");
                        document.getElementById("subjectPage").classList.add("hidden");
                        document.getElementById("unitPage").classList.add("hidden");
                        document.getElementById("lessonPage").classList.add("hidden");

                        // âœ… Ø¥Ø®ÙØ§Ø¡ Ù…Ø³Ø§Ø± Ø§Ù„Ø¯Ø±Ø³ ÙÙŠ ÙƒÙ„ Ø§Ù„ØªÙ†Ù‚Ù„Ø§Øª
                        document.getElementById("lessonPath").style.display = "none";
                    }

                    // ğŸ”´ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù†Ø¯ Ù…ØºØ§Ø¯Ø±Ø© ØµÙØ­Ø© Ø§Ù„Ø¯Ø±Ø³
                    function stopVideo() {
                        const video = document.getElementById("lessonPlayer");
                        if (video) {
                            video.pause();
                            video.currentTime = 0;
                            video.src = "";
                        }
                    }
                    function updateLessonNav(showBackUnit = true) {
                        const btnBackUnit = document.getElementById("btnBackUnit");
                        const btnHome = document.getElementById("btnHome");

                        if (btnBackUnit) {
                            btnBackUnit.style.display = showBackUnit ? "inline-block" : "none";
                        }

                        if (btnHome) {
                            btnHome.style.display = "inline-block";
                        }
                    }
                    function updateGlobalNav(show) {
                        const nav = document.getElementById("globalNav");
                        if (!nav) return;

                        if (show) {
                            nav.classList.remove("hidden");
                        } else {
                            nav.classList.add("hidden");
                        }
                    }

                    function toggleLessons() {
                        const list = document.getElementById("lessonList");
                        list.style.display = list.style.display === "none" ? "block" : "none";
                    }
                    function toggleDarkMode() {
                        const body = document.body;
                        const btn = document.getElementById('darkModeBtn');

                        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ / Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ
                        body.classList.toggle("dark-mode");

                        // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ø²Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
                        if (body.classList.contains("dark-mode")) {
                            btn.textContent = "â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ";
                        } else {
                            btn.textContent = "ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ";
                        }

                        // Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
                        localStorage.setItem("darkMode", body.classList.contains("dark-mode"));
                    }

                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ø²Ø± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                    window.onload = function () {
                        const btn = document.getElementById('darkModeBtn');

                        // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ø¥Ø°Ø§ ØªÙ… Ø­ÙØ¸Ù‡ Ù…Ø³Ø¨Ù‚Ù‹Ø§
                        if (localStorage.getItem("darkMode") === "true") {
                            document.body.classList.add("dark-mode");
                        }

                        // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ø²Ø± Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ¹Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                        if (btn) {
                            if (document.body.classList.contains("dark-mode")) {
                                btn.textContent = "â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ";
                            } else {
                                btn.textContent = "ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ";
                            }
                        }
                    };

                </script>
                <!--<div>
                <script src="js/auth.js"></script>
                <script src="js/data.js"></script>
                <script src="js/navigation.js"></script>
                <script src="js/lessons.js"></script>
                <script src="js/admin.js"></script>
                <script src="js/app.js"></script>
                </div>-->
                <!-- Firebase SDK -->
                <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
                <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

                <!-- Firebase init -->
                <script src="./js/firebase.js"></script>
                <script>
                    if ('serviceWorker' in navigator) {
                        navigator.serviceWorker.register('/Al-Tamsahya-Online-Education/service-worker.js')
                            .then(reg => {
                                console.log('Service Worker registered.');

                                // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù†Ø³Ø®Ø© Ø¬Ø¯ÙŠØ¯Ø©
                                reg.addEventListener('updatefound', () => {
                                    const newWorker = reg.installing;
                                    newWorker.addEventListener('statechange', () => {
                                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                            newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        }
                                    });
                                });

                                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ ØªØºÙŠØ± Ø§Ù„Ù€ SW
                                let refreshing = false;
                                navigator.serviceWorker.addEventListener('controllerchange', () => {
                                    if (!refreshing) {
                                        refreshing = true;
                                        console.log('Controller changed: Reloading page...');
                                        window.location.reload();
                                    }
                                });
                            })
                            .catch(err => console.error('SW registration failed:', err));
                    }
                </script>

                <!-- Ø¬Ù…ÙŠØ¹ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø¯Ù…Ù† ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª -->
                <script>
                    // ===================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… =====================
                    const adminEmail = "admin@gmail.com";
                    const loggedEmail = localStorage.getItem("loggedEmail") || "";
                    const userRole = localStorage.getItem("userRole") || "STUDENT";

                    window.currentUser = { email: loggedEmail, role: userRole };

                    // ===================== Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© =====================
                    let deferredPrompt = null;
                    let animationTimeout = null;

                    // ===================== ØªÙ‡ÙŠØ¦Ø© Firebase =====================
                    if (typeof firebase !== "undefined") {
                        if (!firebase.apps.length && typeof firebaseConfig !== "undefined") {
                            firebase.initializeApp(firebaseConfig);
                        }
                        if (typeof window.firestoreTools === "undefined" && firebase.firestore) {
                            const db = firebase.firestore();
                            window.firestoreTools = { db, collection: db.collection.bind(db) };
                        }
                    }
                    const db = window.firestoreTools?.db || (firebase?.firestore ? firebase.firestore() : null);

                    // ğŸ”¹ Ø¯ÙˆØ§Ù„ Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
                    function showAnnouncementBar() {
                        const bar = document.getElementById("announcementBar");
                        if (bar) bar.style.display = "flex";
                    }

                    function hideAnnouncementBar() {
                        const bar = document.getElementById("announcementBar");
                        if (bar) bar.style.display = "none";
                        if (animationTimeout) {
                            clearTimeout(animationTimeout);
                            animationTimeout = null;
                        }
                    }

                    function restartAnimation() {
                        const announcementText = document.getElementById("announcementText");
                        if (!announcementText) return;

                        announcementText.style.animation = "none";
                        announcementText.style.left = "-100%";
                        announcementText.offsetHeight;

                        const textLength = announcementText.offsetWidth;
                        const duration = Math.max(15, textLength / 50);
                        announcementText.style.animation = `slide-right ${duration}s linear infinite`;
                    }

                    async function loadAnnouncement() {
                        try {
                            if (!window.firestoreTools) return;
                            const doc = await window.firestoreTools.collection("announcements").doc("current").get();
                            if (doc.exists) {
                                const text = doc.data().text || "";
                                if (!text) return;
                                const announcementText = document.getElementById("announcementText");
                                if (!announcementText) return;
                                announcementText.innerText = text;
                                restartAnimation();
                                showAnnouncementBar();
                            }
                        } catch (err) {
                            console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:", err);
                        }
                    }

                    // ğŸ”¹ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø¯Ù…Ù†
                    async function saveAnnouncement() {
                        const input = document.getElementById("adminAdText");
                        if (!input) return;
                        const text = input.value.trim();
                        if (!text) { alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø£ÙˆÙ„Ø§Ù‹!"); return; }

                        try {
                            await window.firestoreTools.collection("announcements").doc("current").set({ text });
                            const announcementText = document.getElementById("announcementText");
                            if (announcementText) { announcementText.innerText = text; restartAnimation(); }
                            showAnnouncementBar();
                            alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† âœ…");
                        } catch (err) {
                            console.error(err);
                            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸ âŒ\n" + err.message);
                        }
                    }

                    async function deleteAnnouncement() {
                        try {
                            await window.firestoreTools.collection("announcements").doc("current").set({ text: "" });
                            hideAnnouncementBar();
                            alert("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† âœ…");
                        } catch (err) {
                            console.error(err);
                            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù âŒ\n" + err.message);
                        }
                    }

                    // ===================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ø´Ø±ÙÙŠÙ† =====================
                    async function deleteUser(docId, collectionName) {
                        if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) return;
                        try {
                            await db.collection(collectionName).doc(docId).delete();
                            alert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­ âœ…");
                            if (collectionName === "students") renderStudents();
                            if (collectionName === "users") renderSupervisors();
                        } catch (err) { console.error(err); alert("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù âŒ\n" + err.message); }
                    }

                    async function setApprove(studentDocId, approvedValue) {
                        try {
                            const ref = db.collection("students").doc(studentDocId);
                            const snap = await ref.get();
                            if (!snap.exists) return;
                            if (snap.data().approved === true) { alert("Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙØ¹Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ âœ…"); return; }
                            await ref.update({ approved: approvedValue });
                            alert("ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© âœ…");
                            renderStudents();
                        } catch (err) { console.error(err); alert("ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« âŒ"); }
                    }
                    async function rejectStudent(studentDocId) {
                        if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø±ÙØ¶ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ­Ø°Ù Ø·Ù„Ø¨Ù‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) return;
                        try {
                            await db.collection("students").doc(studentDocId).delete();
                            alert("ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ­Ø°ÙÙ‡ âŒ");
                            renderStudents();
                        } catch (err) { console.error(err); alert("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¶ âŒ\n" + err.message); }
                    }
                    // ===================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ§Ù„ØªÙ†Ù‚Ù„ =====================

                    // Ø¥ØºÙ„Ø§Ù‚ Ø£ÙŠ Ù†Ø§ÙØ°Ø©/Ù†Ù…ÙˆØ°Ø¬
                    function closeModal(id) {
                        const el = document.getElementById(id);
                        if (el) el.style.display = "none";
                    }

                    // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                    function renderTests() {
                        const container = document.getElementById("testsList");
                        if (!container) return;
                        container.innerHTML = `<h4>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h4><p>Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„Ø§Ø­Ù‚Ø§Ù‹.</p>`;
                        container.classList.remove("hidden");

                        ["studentsList", "supervisorsList", "resultsList"].forEach(id => {
                            const el = document.getElementById(id);
                            if (el) el.classList.add("hidden");
                        });
                    }

                    // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
                    function renderResults() {
                        const container = document.getElementById("resultsList");
                        if (!container) return;
                        container.innerHTML = `<h4>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h4><p>Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù„Ù„Ø·Ù„Ø§Ø¨.</p>`;
                        container.classList.remove("hidden");

                        ["studentsList", "supervisorsList", "testsList"].forEach(id => {
                            const el = document.getElementById(id);
                            if (el) el.classList.add("hidden");
                        });
                    }

                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙ†Ù‚Ù„ (Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª Ø¹Ø¯Ø§ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
                    function resetNavigation() {
                        ["gradePage", "subjectPage", "unitPage", "lessonPage"].forEach(id => {
                            const el = document.getElementById(id);
                            if (el) el.classList.add("hidden");
                        });

                        const lessonPath = document.getElementById("lessonPath");
                        if (lessonPath) lessonPath.style.display = "none";
                    }

                    // ğŸ”´ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù†Ø¯ Ù…ØºØ§Ø¯Ø±Ø© ØµÙØ­Ø© Ø§Ù„Ø¯Ø±Ø³
                    function stopVideo() {
                        const video = document.getElementById("lessonPlayer");
                        if (video) {
                            video.pause();
                            video.currentTime = 0;
                            video.src = "";
                        }
                    }

                    // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¯Ø±Ø³
                    function updateLessonNav(showBackUnit = true) {
                        const btnBackUnit = document.getElementById("btnBackUnit");
                        if (btnBackUnit) btnBackUnit.style.display = showBackUnit ? "inline-block" : "none";

                        const btnHome = document.getElementById("btnHome");
                        if (btnHome) btnHome.style.display = "inline-block";
                    }

                    // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ø§Ù…
                    function updateGlobalNav(show) {
                        const nav = document.getElementById("globalNav");
                        if (!nav) return;
                        if (show) nav.classList.remove("hidden");
                        else nav.classList.add("hidden");
                    }

                    // ØªØ¨Ø¯ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³
                    function toggleLessons() {
                        const list = document.getElementById("lessonList");
                        if (list) list.style.display = list.style.display === "none" ? "block" : "none";
                    }
                    // ğŸ”¹ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
                    function toggleDarkMode() {
                        const body = document.body;
                        const btn = document.getElementById('darkModeBtn');
                        body.classList.toggle("dark-mode");
                        if (btn) btn.textContent = body.classList.contains("dark-mode") ? "â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ" : "ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ";
                        localStorage.setItem("darkMode", body.classList.contains("dark-mode"));
                    }

                    window.addEventListener("DOMContentLoaded", () => {
                        const btn = document.getElementById('darkModeBtn');
                        if (localStorage.getItem("darkMode") === "true") document.body.classList.add("dark-mode");
                        if (btn) btn.textContent = document.body.classList.contains("dark-mode") ? "â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ" : "ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ";

                        loadAnnouncement();

                        document.getElementById("saveAdBtn")?.addEventListener("click", saveAnnouncement);
                        document.getElementById("stopAdBtn")?.addEventListener("click", deleteAnnouncement);
                        document.getElementById("loginForm")?.addEventListener("submit", async (e) => {
                            e.preventDefault();
                            const email = e.target.email.value.trim();
                            const password = e.target.password.value.trim();
                            try {
                                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                                const user = userCredential.user;
                                const userDoc = await firebase.firestore().collection("users").doc(user.uid).get();
                                const role = userDoc.exists ? userDoc.data().role : "STUDENT";
                                localStorage.setItem("loggedEmail", email);
                                localStorage.setItem("userRole", role);
                                window.currentUser = { email, role };
                                window.location.href = role === "ADMIN" ? "admin.html" : "index.html";
                            } catch (err) { alert("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âŒ\n" + err.message); }
                        });

                </script>

                async function deleteAnnouncement() {
                try {
                if (!window.firestoreTools || !window.firestoreTools.collection) {
                alert("Firestore Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯ âŒ");
                return;
                }

                await window.firestoreTools.collection("announcements").doc("current").set({ text: "" });

                if (typeof hideAnnouncementBar === "function") hideAnnouncementBar();
                alert("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† âœ…");
                } catch (err) {
                console.error(err);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù âŒ\n" + err.message);
                }
                }

                // ğŸ”¹ Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯Ù‡Ø§
                const saveAdBtn = document.getElementById("saveAdBtn");
                if (saveAdBtn) saveAdBtn.addEventListener("click", saveAnnouncement);

                const stopAdBtn = document.getElementById("stopAdBtn");
                if (stopAdBtn) stopAdBtn.addEventListener("click", deleteAnnouncement);

                // ğŸ”¹ auth.js
                const loginForm = document.getElementById("loginForm");
                if (loginForm) {
                loginForm.addEventListener("submit", async (e) => {
                e.preventDefault();

                const email = e.target.email.value.trim();
                const password = e.target.password.value.trim();

                try {
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Firebase Auth
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ± Ù…Ù† Firestore
                const userDoc = await firebase.firestore().collection("users").doc(user.uid).get();
                const role = userDoc.exists ? userDoc.data().role : "STUDENT";

                // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                localStorage.setItem("loggedEmail", email);
                localStorage.setItem("userRole", role);

                window.currentUser = { email, role };

                // Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
                if (role === "ADMIN") window.location.href = "admin.html";
                else window.location.href = "index.html";

                } catch (err) {
                alert("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âŒ\n" + err.message);
                }
                });
                }

                });
                </script>

                // ======= Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª =======
                const adsContainer = document.getElementById("ads-container");

                if (adsContainer && window.firestoreTools && firestoreTools.collection) {

                firestoreTools.collection("ads")
                .orderBy("date", "desc")
                .onSnapshot(snapshot => {

                adsContainer.innerHTML = "";

                snapshot.forEach(doc => {
                const ad = doc.data();
                const adElement = document.createElement("div");

                adElement.className = "ad";
                adElement.innerHTML = `
                <h3>${ad.title}</h3>
                <p>${ad.content}</p>
                <small>${ad.date?.toDate ? ad.date.toDate().toLocaleString() : ""}</small>
                `;

                adsContainer.appendChild(adElement);
                });

                });
                }

                // ======= Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…ØªØ­Ø±Ùƒ =======
                if (window.firestoreTools && window.firestoreTools.db) {

                const db = window.firestoreTools.db;

                db.collection("announcements")
                .doc("current")
                .onSnapshot(doc => {

                if (doc.exists && doc.data()?.text?.trim()) {
                startAnnouncementAnimation(doc.data().text, 12000);
                } else {
                hideAnnouncementBar();
                }

                });
                }

                // ======= ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ PWA =======
                document.addEventListener("DOMContentLoaded", () => {
                const installBtn = document.getElementById("installBtn");
                let deferredPrompt = null; // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø­Ø¯Ø« beforeinstallprompt

                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø­Ø¯Ø« Ù‚Ø¨Ù„ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                window.addEventListener("beforeinstallprompt", (e) => {
                e.preventDefault(); // Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                deferredPrompt = e;  // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø­Ø¯Ø« Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§
                if (installBtn) installBtn.hidden = false; // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
                });

                // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
                if (installBtn) {
                installBtn.addEventListener("click", async () => {
                if (!deferredPrompt) return; // Ø¥Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… PWA Ù„Ø§ Ù†ÙØ¹Ù„ Ø´ÙŠØ¡

                // Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø³Ù…ÙŠ
                deferredPrompt.prompt();

                // Ø§Ù†ØªØ¸Ø§Ø± Ù†ØªÙŠØ¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                await deferredPrompt.userChoice;

                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª Ø£Ùˆ Ø§Ù„Ø¥Ù„ØºØ§Ø¡
                installBtn.hidden = true;

                deferredPrompt = null; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯Ø«
                });
                }

                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø­Ø¯Ø« ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªØ«Ø¨ÙŠØª
                window.addEventListener("appinstalled", () => {
                if (installBtn) installBtn.hidden = true; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª
                console.log("ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
                });
                });
                </script>



                <!-- ======= ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…ØªØ­Ø±Ùƒ ======= -->
                <script>
                    function startAnnouncementAnimation(text, duration = 12000) {
                        const bar = document.getElementById("announcementBar");
                        const textBox = document.getElementById("announcementText");

                        if (!bar || !textBox || !text?.trim()) {
                            hideAnnouncementBar();
                            return;
                        }

                        textBox.innerText = "ğŸ“¢ " + text + " ğŸ“¢";
                        bar.style.display = "flex";

                        const screenWidth = bar.offsetWidth;
                        const textWidth = textBox.offsetWidth;

                        function move() {
                            textBox.style.transition = "none";
                            textBox.style.left = -textWidth + "px";

                            setTimeout(() => {
                                textBox.style.transition = `left ${duration}ms linear`;
                                textBox.style.left = screenWidth + "px";
                            }, 50);

                            animationTimeout = setTimeout(move, duration + 2000);
                        }

                        if (animationTimeout) clearTimeout(animationTimeout);
                        move();
                    }

                    function hideAnnouncementBar() {
                        const bar = document.getElementById("announcementBar");
                        if (bar) bar.style.display = "none";

                        if (animationTimeout) {
                            clearTimeout(animationTimeout);
                            animationTimeout = null;
                        }
                    }
                </script>

                <!-- Ø²Ø± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
                <!-- Ø²Ø± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
                <button id="installBtn" class="btn" hidden>ğŸ“² ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>

                <script>
                    async function installApp() {
                        if (!deferredPrompt) {
                            alert("ğŸ“Œ Ø§ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â‹® Ø«Ù… Ø§Ø®ØªØ± (ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚)");
                            return;
                        }

                        await deferredPrompt.prompt();
                        await deferredPrompt.userChoice;
                        deferredPrompt = null;
                    }
                </script>

                <!-- ğŸ”” Ù…Ø±Ø¨Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¯Ø§Ø®Ù„ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† -->
                <!-- ğŸ”” Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø£Ø¯Ù…Ù†) -->
                <div id="adminAdBox"
                     style="display:none; border:2px dashed #f39c12; padding:15px; margin:20px; border-radius:8px;">

                    <h4>ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù† Ø¹Ø§Ù… Ù„Ù„Ø·Ù„Ø§Ø¨</h4>

                    <textarea id="adminAdText"
                              placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù‡Ù†Ø§..."
                              style="width:100%; min-height:80px; padding:8px;"></textarea>

                    <div style="margin-top:10px;">
                        <button id="saveAdBtn" class="custom-btn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
                        <button id="stopAdBtn" class="custom-btn danger">ğŸ—‘ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
                    </div>
                </div>

                <style>
                    .announcement-bar {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        background: #2563eb;
                        color: #fff;
                        overflow: hidden;
                        z-index: 9999;
                        height: 45px;
                        display: flex;
                        align-items: center;
                    }

                    .announcement-text {
                        white-space: nowrap;
                        font-weight: bold;
                        font-size: 16px;
                        display: inline-block;
                        position: relative;
                        left: -100%; /* Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */
                        animation: slide-right 15s linear infinite; /* Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ø´Ù…Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
                    }

                    @keyframes slide-right {
                        0% {
                            left: -100%;
                        }

                        100% {
                            left: 100%;
                        }
                    }


                    @keyframes slide-left {
                        0% {
                            left: 100%;
                        }

                        100% {
                            left: -100%;
                        }
                    }

                    body {
                        padding-top: 45px;
                    }
                </style>

                <script>
                    // ğŸ”¹ ØªÙ‡ÙŠØ¦Ø© Firebase Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· (Ø¨Ø­Ù…Ø§ÙŠØ© ÙƒØ§Ù…Ù„Ø©)
                    if (typeof firebase !== "undefined") {
                        if (!firebase.apps.length && typeof firebaseConfig !== "undefined") {
                            firebase.initializeApp(firebaseConfig);
                        }
                    }

                    // Ø­Ù…Ø§ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ firestoreTools
                    if (typeof window.firestoreTools === "undefined") {
                        if (typeof firebase !== "undefined" && firebase.firestore) {
                            const db = firebase.firestore();
                            window.firestoreTools = {
                                db: db,
                                collection: db.collection.bind(db)
                            };
                        }
                    }

                    const db = (window.firestoreTools && window.firestoreTools.db)
                        ? window.firestoreTools.db
                        : (typeof firebase !== "undefined" ? firebase.firestore() : null);

                    // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
                    function showAnnouncementBar() {
                        const bar = document.getElementById("announcementBar");
                        if (bar) bar.style.display = "flex";
                    }

                    function hideAnnouncementBar() {
                        const bar = document.getElementById("announcementBar");
                        if (bar) bar.style.display = "none";
                    }

                    // ğŸ”¹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù…Ø¹ Ø³Ø±Ø¹Ø© Ù…Ù†Ø§Ø³Ø¨Ø©
                    function restartAnimation() {
                        const announcementText = document.getElementById("announcementText");
                        if (!announcementText) return;

                        // Ø£ÙˆÙ‚Ù Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ø¤Ù‚ØªÙ‹Ø§
                        announcementText.style.animation = "none";

                        // Ø¶Ø¹ Ø§Ù„Ù†Øµ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù…Ø§Ù„ (Ø®Ø§Ø±Ø¬ Ø§Ù„Ø´Ø§Ø´Ø©) Ø­ØªÙ‰ ÙŠØ¸Ù‡Ø± ÙÙˆØ±Ù‹Ø§
                        announcementText.style.left = "-100%";

                        // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ CSS
                        announcementText.offsetHeight;

                        // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ø­Ø±ÙƒØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·ÙˆÙ„ Ø§Ù„Ù†Øµ
                        const textLength = announcementText.offsetWidth;
                        const duration = Math.max(15, textLength / 50); // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 15 Ø«Ø§Ù†ÙŠØ©

                        // Ø£Ø¹Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ø´Ù…Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†
                        announcementText.style.animation = `slide-right ${duration}s linear infinite`;
                    }

                    // ğŸ”¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ø·Ù„Ø§Ø¨
                    async function loadAnnouncement() {
                        try {
                            if (!window.firestoreTools) return;

                            const doc = await window.firestoreTools.collection("announcements").doc("current").get();
                            if (doc.exists) {
                                const text = doc.data().text || "";
                                if (text) {
                                    const announcementText = document.getElementById("announcementText");
                                    if (!announcementText) return;

                                    announcementText.innerText = text;

                                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ø¨Ø³Ø±Ø¹Ø© Ù…Ù†Ø§Ø³Ø¨Ø©
                                    restartAnimation();

                                    showAnnouncementBar();
                                }
                            }
                        } catch (err) {
                            console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:", err);
                        }
                    }

                    window.addEventListener("DOMContentLoaded", loadAnnouncement);

                    // ğŸ”¹ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø¯Ù…Ù†
                    async function saveAnnouncement() {
                        const input = document.getElementById("adminAdText");
                        if (!input) return;

                        const text = input.value.trim();
                        if (!text) {
                            alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø£ÙˆÙ„Ø§Ù‹!");
                            return;
                        }

                        try {
                            await window.firestoreTools.collection("announcements").doc("current").set({ text });

                            const announcementText = document.getElementById("announcementText");
                            if (announcementText) {
                                announcementText.innerText = text;
                                restartAnimation();
                            }

                            showAnnouncementBar();
                            alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† âœ…");
                        } catch (err) {
                            console.error(err);
                            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸ âŒ\n" + err.message);
                        }
                    }

                    async function deleteAnnouncement() {
                        try {
                            await window.firestoreTools.collection("announcements").doc("current").set({ text: "" });
                            hideAnnouncementBar();
                            alert("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† âœ…");
                        } catch (err) {
                            console.error(err);
                            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù âŒ\n" + err.message);
                        }
                    }

                    // ğŸ”¹ Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                    const saveAdBtn = document.getElementById("saveAdBtn");
                    if (saveAdBtn) saveAdBtn.addEventListener("click", saveAnnouncement);

                    const stopAdBtn = document.getElementById("stopAdBtn");
                    if (stopAdBtn) stopAdBtn.addEventListener("click", deleteAnnouncement);
                </script>
                <script>
                    // auth.js
                    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯ÙˆØ±
                    document.getElementById("loginForm").addEventListener("submit", async (e) => {
                        e.preventDefault();

                        const email = e.target.email.value.trim();
                        const password = e.target.password.value.trim();

                        try {
                            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Firebase Auth
                            const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                            const user = userCredential.user;

                            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ± Ù…Ù† Firestore
                            const userDoc = await firebase.firestore().collection("users").doc(user.uid).get();
                            const role = userDoc.exists ? userDoc.data().role : "STUDENT";

                            // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                            localStorage.setItem("loggedEmail", email);
                            localStorage.setItem("userRole", role);
                            window.currentUser = { email, role };

                            // Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
                            if (role === "ADMIN") window.location.href = "admin.html";
                            else window.location.href = "index.html";

                        } catch (err) {
                            alert("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âŒ\n" + err.message);
                        }
                    });
                </script>
</body>
</html>

